import"./bubble_simulation.8d2f6bb2.js";var t=globalThis,e={},i={},s=t.parcelRequire0087;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in i){var s=i[t];delete i[t];var h={id:t,exports:{}};return e[t]=h,s.call(h.exports,h,h.exports),h.exports}var a=Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(t,e){i[t]=e},t.parcelRequire0087=s),s.register;var h=s("ilwiq"),a=s("dyjou"),r=s("9sWXr"),n=s("5Rd1x");class o{constructor(){this.alpha=1/1024,this.beta=1/502,this.gamma=1/502,this.rho=1e3,this.g=9.8,this.p_atm=101325,this.S_B=.0142,this.S_C=.0142,this.V_D0=.00355,this.h_B0_ref=.04,this.h_C0_ref=.21,this.h_6=.33,this.H=.25,this.eta=.001,this.S=285e-7,this.L1=.22,this.L2=.31,this.B1=8*Math.PI*this.eta*this.L1/this.S,this.B2=8*Math.PI*this.eta*this.L2/this.S,this.y0=[.06,.04,.2],this.EPS_DHB=1e-4,this.T_GUARD=10,this.t=0,this.h_A=0,this.h_B=0,this.h_C=0,this.v4=0,this.isStable=!1,this.reset()}reset(){[this.h_A,this.h_B,this.h_C]=this.y0,this.t=0,this.v4=0,this.isStable=!1}system(t,e,i){let s=(this.h_B0_ref-e)*this.S_B+(this.h_C0_ref-i)*this.S_C,h=this.V_D0+s,a=this.p_atm*this.V_D0/h,r=this.p_atm-a+this.rho*this.g*(t+this.H-e),n=a-this.p_atm+this.rho*this.g*(i-this.h_6),o=(-this.B1+Math.sqrt(this.B1**2+2*this.rho*Math.max(r,0)))/this.rho,l=(-this.B2+Math.sqrt(this.B2**2+2*this.rho*Math.max(n,0)))/this.rho;this.v4=l;let c=-this.alpha*o+this.alpha*l;return[c,this.beta*o,-this.gamma*l]}step(t){if(this.isStable)return;let[e,i,s]=this.system(this.h_A,this.h_B,this.h_C);if(this.t>this.T_GUARD&&Math.abs(i)<this.EPS_DHB){this.isStable=!0,this.v4=0;return}this.h_A+=e*t,this.h_B+=i*t,this.h_C+=s*t,this.t+=t,this.h_A=Math.max(0,this.h_A),this.h_B=Math.max(0,this.h_B),this.h_C=Math.max(0,this.h_C)}}class l{constructor(t="scene-container"){if(this.container=document.getElementById(t),!this.container)throw Error(`Container element with id '${t}' not found.`);this.guiParams={isRunning:!1,timeScale:1,viewMode:"3D",playPause:()=>{this.guiParams.isRunning=!this.guiParams.isRunning,this.handlePlayPause()},reset:()=>{this.resetAll()}},this.clock=new a.Clock(!1),this.elapsedTime=0,this.scene=new a.Scene,this.renderer=new h.WebGLRenderer({antialias:!0}),this.controls=null,this.camera2D=null,this.camera3D=null,this.camera=null,this.h_jet=0,this.scale=20,this.physics=new o,this.waterA=null,this.waterB=null,this.waterC=null,this.fountainParticles=null,this.particleVelocities=null,this.particleCount=2500,this.textOverlay=null,this.textGroups={},this.H_scaled=this.physics.H*this.scale,this.h6_scaled=this.physics.h_6*this.scale,this.worldWidth=.3*this.scale,this.worldDepth=.1*this.scale,this.internalWallBCH=.22*this.scale,this.topBasinY=this.H_scaled,this.topBasinHeight=6,this.initThree(),this.setupSceneGeometry(),this.setupGUI(),this.addTextLabels(),this.resetAll(),this.animate=this.animate.bind(this),this.animate()}initThree(){this.scene.background=new h.Color(1710634),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement);let t=this.container.clientWidth/this.container.clientHeight;this.camera2D=new h.OrthographicCamera(-15*t,15*t,15,-15,.1,100),this.camera2D.position.set(0,0,50),this.camera2D.lookAt(0,this.H_scaled,0),this.camera3D=new h.PerspectiveCamera(50,t,.1,200),this.camera3D.position.set(15,12,25),this.camera3D.lookAt(0,this.H_scaled,0),this.camera=this.camera3D,this.controls=new(0,n.OrbitControls)(this.camera3D,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.target.set(0,this.H_scaled,0),this.controls.enabled="3D"===this.guiParams.viewMode;let e=new a.AmbientLight(0xffffff,.7);this.scene.add(e);let i=new a.DirectionalLight(0xffffff,1);i.position.set(10,20,15),i.castShadow=!0,this.scene.add(i),window.addEventListener("resize",this.onWindowResize.bind(this))}setupSceneGeometry(){let t=new a.MeshPhysicalMaterial({color:2130175,transmission:.9,thickness:1.5*this.scale,roughness:.1,ior:1.33,transparent:!0,side:h.DoubleSide}),e=new a.MeshPhysicalMaterial({color:0xffffff,transmission:.95,thickness:.5,roughness:.05,ior:1.52,transparent:!0,opacity:.3,side:h.DoubleSide}),i=new a.MeshStandardMaterial({color:9474192,roughness:.3,metalness:.5}),s=this.worldWidth/2,r=this.worldDepth,n=new h.BoxGeometry(1,1,1);this.waterA=new h.Mesh(n,t.clone()),this.waterA.scale.set(this.worldWidth,1,r),this.scene.add(this.waterA),this.waterB=new h.Mesh(n,t.clone()),this.waterB.scale.set(s,1,r),this.waterB.position.x=-s/2,this.scene.add(this.waterB),this.waterC=new h.Mesh(n,t.clone()),this.waterC.scale.set(s,1,r),this.waterC.position.x=s/2,this.scene.add(this.waterC);let o=(t,i,s,a,r,n)=>{let o=new h.BoxGeometry(t,i,s),l=new h.Mesh(o,e);return l.position.set(a,r,n),this.scene.add(l),l};o(this.worldWidth+.4,.2,r+.4,0,-.1,0),o(this.worldWidth+.4,.2,r+.4,0,this.H_scaled,0),o(this.worldWidth+.4,.2,r+.4,0,this.topBasinY+this.topBasinHeight,0);let l=this.topBasinY+this.topBasinHeight;o(.2,l,r+.2,-this.worldWidth/2-.1,l/2-.1,0),o(.2,l,r+.2,this.worldWidth/2+.1,l/2-.1,0),o(this.worldWidth+.4,l,.2,0,l/2-.1,-r/2-.1),o(this.worldWidth+.4,l,.2,0,l/2-.1,r/2+.1),o(.2,this.internalWallBCH,r,0,this.internalWallBCH/2,0);let c=(t,e,s,r)=>{let n=new a.CylinderGeometry(.2,.2,t,16),o=new h.Mesh(n,i);return o.position.set(e,s,r),this.scene.add(o),o};c(this.H_scaled,-s/2,this.H_scaled/2,0),this.pipe56=c(this.h6_scaled,s/2,this.h6_scaled/2,0);let d=new h.BufferGeometry,p=new Float32Array(3*this.particleCount);this.particleVelocities=new Float32Array(3*this.particleCount);let m=new Float32Array(this.particleCount),u=new Float32Array(this.particleCount);for(let t=0;t<this.particleCount;t++)p[3*t+0]=this.pipe56.position.x,p[3*t+1]=this.h6_scaled,p[3*t+2]=this.pipe56.position.z,this.particleVelocities[3*t+0]=0,this.particleVelocities[3*t+1]=0,this.particleVelocities[3*t+2]=0,m[t]=0,u[t]=Math.random();d.setAttribute("position",new h.BufferAttribute(p,3)),d.setAttribute("offset",new h.BufferAttribute(u,1)),d.setAttribute("lifetime",new h.BufferAttribute(m,1));let w=new a.PointsMaterial({color:8438015,size:.12,sizeAttenuation:!0,transparent:!0,opacity:.9,depthWrite:!1,blending:h.AdditiveBlending});this.fountainParticles=new a.Points(d,w),this.scene.add(this.fountainParticles);let y=.06*this.scale,x=new a.CylinderGeometry(y,y,.1,12,1,!0),_=new a.MeshPhysicalMaterial({color:6338815,transmission:.8,transparent:!0,opacity:.5,roughness:.2,metalness:0,side:h.DoubleSide});this.coreStream=new h.Mesh(x,_),this.coreStream.visible=!1,this.scene.add(this.coreStream)}setupGUI(){let t=new(0,r.default)({title:"Heron's Fountain Controls"});t.add(this.guiParams,"playPause").name("▶️ / ⏸️ Start/Pause"),t.add(this.guiParams,"reset").name("\uD83D\uDD04 Reset All"),t.add(this.guiParams,"timeScale",.1,5,.1).name("Time Scale"),t.add(this.guiParams,"viewMode",["2D","3D"]).name("View Mode").onChange(t=>{this.camera="2D"===t?this.camera2D:this.camera3D,this.controls.enabled="3D"===t,this.onWindowResize()})}resetAll(){this.guiParams.isRunning=!1,this.clock.stop(),this.elapsedTime=0,this.physics.reset(),this.h_jet=0,this.updateWaterMeshes();let t=this.fountainParticles.geometry.getAttribute("position"),e=this.fountainParticles.geometry.getAttribute("lifetime"),i=this.pipe56.position.x,s=this.h6_scaled,h=this.pipe56.position.z;for(let a=0;a<this.particleCount;a++)t.array[3*a+0]=i,t.array[3*a+1]=s,t.array[3*a+2]=h,this.particleVelocities[3*a+0]=0,this.particleVelocities[3*a+1]=0,this.particleVelocities[3*a+2]=0,e.array[a]=0;t.needsUpdate=!0,e.needsUpdate=!0,this.coreStream.visible=!1,this.coreStream.scale.set(1,.001,1),this.updateTextLabels()}handlePlayPause(){this.guiParams.isRunning?(this.physics.isStable&&this.resetAll(),this.guiParams.isRunning=!0,this.clock.start()):this.clock.stop()}updateWaterMeshes(){let{h_A:t,h_B:e,h_C:i}=this.physics,s=this.scale,h=Math.max(.01,t*s),a=Math.max(.01,e*s),r=Math.max(.01,i*s);this.waterA.scale.y=h,this.waterA.position.y=this.H_scaled+h/2,this.waterB.scale.y=a,this.waterB.position.y=a/2,this.waterC.scale.y=r,this.waterC.position.y=r/2}updateFountain(t){let e=this.fountainParticles.geometry.getAttribute("position"),i=this.fountainParticles.geometry.getAttribute("lifetime"),s=this.particleVelocities,r=new h.Vector3(0,-this.physics.g*this.scale*.8,0),n=Math.max(0,this.physics.v4)*this.scale,o=this.pipe56.position.x,l=this.h6_scaled,c=this.pipe56.position.z,d=new h.Vector3(0,1,0).applyQuaternion(this.pipe56.quaternion).normalize(),p=this.waterA.position.y+this.waterA.scale.y/2,m=-this.worldWidth/2,u=this.worldWidth/2,w=-this.worldDepth/2,y=this.worldDepth/2,x=e.array,_=i.array;for(let e=0;e<this.particleCount;e++){let i=3*e,a=x[i],g=x[i+1],f=x[i+2],v=s[i],M=s[i+1],b=s[i+2],B=g<p&&g>this.H_scaled&&a>m&&a<u&&f>w&&f<y,A=g<-10;if(B||A)if(a=o+(Math.random()-.5)*.01,g=l,f=c+(Math.random()-.5)*.01,_[e]=0,n>0&&this.guiParams.isRunning){let t=n*(.95+.1*Math.random()),e=new h.Vector3(Math.random()-.5,Math.random()-.5,Math.random()-.5);e.sub(d.clone().multiplyScalar(e.dot(d))).normalize();let i=.04*t*(.5+ +Math.random()),s=e.multiplyScalar(i);v=d.x*t+s.x,M=d.y*t+s.y,b=d.z*t+s.z}else v=0,M=0,b=0;else M+=r.y*t,v+=(2*Math.random()-1)*1.2*t,b+=(2*Math.random()-1)*1.2*t,a+=v*t,g+=M*t,f+=b*t,_[e]+=t;x[i]=a,x[i+1]=g,x[i+2]=f,s[i]=v,s[i+1]=M,s[i+2]=b}e.needsUpdate=!0,i.needsUpdate=!0;let g=this.physics.v4**2/(2*this.physics.g);this.h_jet=g;let f=g*this.scale;if(this.physics.v4>.01){this.coreStream.visible=!0;let t=Math.max(.02*this.scale,f);this.coreStream.scale.set(1,t/.1,1);let e=new h.Vector3(o,l,c).add(d.clone().multiplyScalar(t/2));this.coreStream.position.copy(e);let i=new h.Vector3(0,1,0),s=new a.Quaternion().setFromUnitVectors(i,d.clone().normalize());this.coreStream.quaternion.copy(s)}else this.coreStream.visible=!1}addTextLabels(){this.textOverlay&&this.textOverlay.remove(),this.textOverlay=document.createElement("div"),this.textOverlay.className="text-label-overlay",this.container.appendChild(this.textOverlay);let t=t=>{let e=document.createElement("div");return e.className="label-group",e.id=t,this.textOverlay.appendChild(e),e};this.textGroups.A=t("label-A"),this.textGroups.B=t("label-B"),this.textGroups.C=t("label-C"),this.textGroups.Time=t("label-Time"),this.textGroups.Jet=t("label-Jet")}toScreenPosition(t,e,i){let s=i.clientWidth,h=i.clientHeight,a=t.clone().project(e);return a.x=(a.x+1)/2*s,a.y=-(a.y-1)/2*h,{x:a.x,y:a.y}}updateTextLabels(){if(!this.textGroups.A)return;this.scale;let t=this.renderer.domElement,e=new h.Vector3(0,this.H_scaled+this.topBasinHeight-1,0),i=new h.Vector3(-this.worldWidth/4,this.H_scaled-1,0),s=new h.Vector3(this.worldWidth/4,this.H_scaled-1,0),a=new h.Vector3(this.worldWidth/4,this.h6_scaled+2,0),r=this.toScreenPosition(e,this.camera,t);this.textGroups.A.style.left=`${r.x}px`,this.textGroups.A.style.top=`${r.y}px`,this.textGroups.A.innerHTML=`
      <div>Bacino A</div>
      <div>h_A: ${(100*this.physics.h_A).toFixed(1)} cm</div>
    `;let n=this.toScreenPosition(i,this.camera,t);this.textGroups.B.style.left=`${n.x}px`,this.textGroups.B.style.top=`${n.y}px`,this.textGroups.B.innerHTML=`
      <div>Bacino B</div>
      <div>h_B: ${(100*this.physics.h_B).toFixed(1)} cm</div>
    `;let o=this.toScreenPosition(s,this.camera,t);this.textGroups.C.style.left=`${o.x}px`,this.textGroups.C.style.top=`${o.y}px`,this.textGroups.C.innerHTML=`
      <div>Bacino C</div>
      <div>h_C: ${(100*this.physics.h_C).toFixed(1)} cm</div>
    `;let l=this.toScreenPosition(a,this.camera,t);this.textGroups.Jet.style.left=`${l.x}px`,this.textGroups.Jet.style.top=`${l.y}px`,this.textGroups.Jet.innerHTML=`
      <div>Getto</div>
      <div>v_4: ${this.physics.v4.toFixed(2)} m/s</div>
      <div>h_jet: ${(100*this.h_jet).toFixed(1)} cm</div>
    `,this.textGroups.Time.style.left="50%",this.textGroups.Time.style.top="20px";let c=this.physics.isStable?"STABILE":this.guiParams.isRunning?"RUNNING":"PAUSED";this.textGroups.Time.innerHTML=`
      <div>Tempo: ${this.physics.t.toFixed(2)} s</div>
      <div>Stato: ${c}</div>
    `}onWindowResize(){let t=this.container.clientWidth/this.container.clientHeight;this.camera2D.left=-15*t,this.camera2D.right=15*t,this.camera2D.top=15,this.camera2D.bottom=-15,this.camera2D.updateProjectionMatrix(),this.camera3D.aspect=t,this.camera3D.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}animate(){if(requestAnimationFrame(this.animate),"3D"===this.guiParams.viewMode&&this.controls.update(),this.guiParams.isRunning){let t=this.clock.getDelta()*this.guiParams.timeScale;this.elapsedTime+=t,this.physics.isStable?(this.guiParams.isRunning=!1,this.clock.stop()):(this.physics.step(t),this.updateWaterMeshes()),this.updateFountain(t)}else this.updateFountain(0);this.updateTextLabels(),this.renderer.render(this.scene,this.camera)}}document.addEventListener("DOMContentLoaded",()=>{try{new l("scene-container")}catch(t){console.error("Impossibile inizializzare la scena:",t),document.getElementById("scene-container").innerHTML="<h3>Errore durante l'inizializzazione della simulazione.</h3><pre>"+t.stack+"</pre>"}});
//# sourceMappingURL=heron_fountain_simulation.9e3f777b.js.map
