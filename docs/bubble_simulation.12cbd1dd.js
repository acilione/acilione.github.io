import"./bubble_simulation.8d2f6bb2.js";var t=globalThis,e={},i={},s=t.parcelRequire0087;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in i){var s=i[t];delete i[t];var a={id:t,exports:{}};return e[t]=a,s.call(a.exports,a,a.exports),a.exports}var r=Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){i[t]=e},t.parcelRequire0087=s),s.register;var a=s("ilwiq"),r=s("9sWXr"),n=s("5Rd1x");let h=Math.PI,o=1.84*1e-5,l=Math.sqrt(16e-6/h);function c(t,e,i,s=2e3){if(e===i)return 0;let a=(i-e)/s,r=.5*(t(e)+t(i));for(let i=1;i<s;i++)r+=t(e+i*a);return r*a}function u(t,e){return Math.pow(t,2.5)*Math.sqrt(1+264.41036488630357*Math.pow(h*o*e/16e-6,2)*t)}function m(t,e){try{let i=c(e=>u(e,t),0,e),s=Math.pow(h,2)*o*t/63488e-16*Math.pow(e,4),a=h/16e-6*Math.sqrt(98.38709677419355)*i;return s+a}catch(t){return console.error("Error in calculate_duration_gen:",t),0}}class d{constructor(t="scene-container"){if(void 0===a)throw Error("THREE.js is not loaded.");if(this.container=document.getElementById(t),!this.container)throw Error(`Container element with id '${t}' not found.`);this.guiParams={R_0:.04,L1:.01,L2:.05,L3:.1,isRunning:!1,scale_factor:40,viewMode:"2D",showDashedLines:!0,playPause:()=>{this.guiParams.isRunning=!this.guiParams.isRunning,this.handlePlayPause()}},this.clock=new a.Clock(!1),this.guiControllers=[],this.controls=null,this.camera2D=null,this.camera3D=null,this.initThree(),this.setupPhysicsAndAnimation(),this.setupGUI(),this.addTextLabels(),this.animate=this.animate.bind(this),this.animate()}getCurrentTheme(){return"dark"===document.documentElement.getAttribute("data-theme")?"dark":"light"}updateSceneTheme(){let t=this.getCurrentTheme();this.scene&&(this.scene.background=new a.Color("dark"===t?856343:0xffffff))}setupThemeObserver(){this.themeObserver=new MutationObserver(t=>{for(let e of t)"attributes"===e.type&&"data-theme"===e.attributeName&&this.updateSceneTheme()}),this.themeObserver.observe(document.documentElement,{attributes:!0})}initThree(){this.scene=new a.Scene,this.scene.background=new a.Color(856343),this.renderer=new a.WebGLRenderer({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.container.appendChild(this.renderer.domElement);let t=this.container.clientWidth/this.container.clientHeight;this.camera2D=new a.OrthographicCamera(-40*t,40*t,40,-40,.1,100),this.camera2D.position.z=5,this.camera3D=new a.PerspectiveCamera(45,t,.1,100),this.camera3D.position.set(0,5,15),this.camera3D.lookAt(0,0,0),this.camera=this.camera2D,this.controls=new(0,n.OrbitControls)(this.camera3D,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enabled=!1;let e=new a.AmbientLight(4210752,10);this.scene.add(e),window.addEventListener("resize",this.onWindowResize.bind(this)),this.straws=[],this.staticCircles=[],this.setupThemeObserver()}onWindowResize(){let t=this.container.clientWidth/this.container.clientHeight;this.camera2D.left=-12*t,this.camera2D.right=12*t,this.camera2D.top=12,this.camera2D.bottom=-12,this.camera2D.updateProjectionMatrix(),this.camera3D.aspect=t,this.camera3D.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.camera="2D"===this.guiParams.viewMode?this.camera2D:this.camera3D,this.animate()}handlePlayPause(){this.guiParams.isRunning?(this.bubble_active=this.bubble_durations.map((t,e)=>this.bubble_times[e]<t),this.clock.start()):this.clock.stop()}resetAnimation(t){let e=`L${t+1}`,i=this.guiParams[e],s=this.guiParams.R_0;this.bubble_durations[t]=m(i,s),this.max_duration=Math.max(...this.bubble_durations),this.bubble_times[t]=0,this.bubble_active[t]=!0;let r=this.positions[t],n=s*this.guiParams.scale_factor,h=i*this.guiParams.scale_factor,o=r.y,l=o-n,c=this.straws[t];c&&(c.scale.set(1,h,1),c.position.set(r.x,o+h/2,0));let u=this.circles[t];if(u&&(u.scale.setScalar(n),u.position.y=l),this.textGroups&&this.textGroups[t]&&(this.textGroups[t].L.textContent=`L: ${(100*i).toFixed(2)} cm`,this.textGroups[t].R.textContent=`R(t): ${(100*s).toFixed(2)} cm`,this.textGroups[t].time.textContent="t: 0.0 s",this.textGroups[t].group.style.opacity=1),s!==this._lastR0||!this.staticCircles[t]){this.staticCircles[t]&&this.scene.remove(this.staticCircles[t]);let e=new a.Vector3(r.x,l,r.z),i=this.createDashedCircle(n,e);i.visible=this.guiParams.showDashedLines,this.scene.add(i),this.staticCircles[t]=i}this.addTextLabels(),this.renderer.render(this.scene,this.camera)}setupPhysicsAndAnimation(){this.scene.children.filter(t=>t.userData&&t.userData.isBubbleComponent).forEach(t=>this.scene.remove(t)),this.straws=[],this.circles=[],this.staticCircles=[];let{L1:t,L2:e,L3:i,R_0:s,scale_factor:r}=this.guiParams;this._lastR0=s,this.Ls=[t,e,i],this.bubble_durations=this.Ls.map(t=>m(t,s)),this.max_duration=Math.max(...this.bubble_durations),this.positions=[new a.Vector3(-8,0,0),new a.Vector3(0,0,0),new a.Vector3(8,0,0)],this.bubble_times=[0,0,0],this.bubble_active=[!0,!0,!0];let n=new a.SphereGeometry(1,32,32),h=l*r,o=new a.CylinderGeometry(h,h,1,32),c=new a.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5,side:a.DoubleSide}),u=s*r;this.Ls.forEach((t,e)=>{let i=this.positions[e],s=t*r,h=i.y,l=h-u,m=new a.Vector3(i.x,l,i.z),d=this.createDashedCircle(u,m);d.userData.isBubbleComponent=!0,d.visible=this.guiParams.showDashedLines,this.scene.add(d),this.staticCircles.push(d);let p=new a.MeshBasicMaterial({color:49151,transparent:!0,opacity:.5,side:a.DoubleSide}),b=new a.Mesh(n,p);b.position.set(i.x,l,i.z),b.scale.setScalar(u),b.userData.isBubbleComponent=!0,this.circles.push(b),this.scene.add(b);let g=new a.Mesh(o,c);g.scale.set(1,s,1),g.position.set(i.x,h+s/2,0),g.userData.isBubbleComponent=!0,this.straws.push(g),this.scene.add(g)})}createDashedCircle(t,e){let i=[];for(let e=0;e<=64;e++){let s=e/64*Math.PI*2;i.push(new a.Vector3(t*Math.cos(s),t*Math.sin(s),0))}let s=new a.BufferGeometry().setFromPoints(i),r=new a.LineDashedMaterial({color:0xffffff,linewidth:1,scale:1,dashSize:.1,gapSize:.1}),n=new a.Line(s,r);return n.computeLineDistances(),n.position.copy(e),n}addTextLabels(){this.textOverlay&&this.textOverlay.remove(),this.textOverlay=document.createElement("div"),this.textOverlay.className="text-label-overlay",this.container.appendChild(this.textOverlay),this.textGroups=[],this.Ls=[this.guiParams.L1,this.guiParams.L2,this.guiParams.L3],this.Ls.forEach((t,e)=>{let i=document.createElement("div");i.className="label-group";let s=document.createElement("div");s.textContent=`L: ${(100*t).toFixed(2)} cm`;let a=document.createElement("div");a.textContent="t: 0.0 s";let r=document.createElement("div");r.textContent=`R(t): ${(100*this.guiParams.R_0).toFixed(2)} cm`,i.appendChild(s),i.appendChild(a),i.appendChild(r),this.textOverlay.appendChild(i),this.textGroups.push({group:i,L:s,time:a,R:r})})}toScreenPosition(t,e,i){let s=i.clientWidth,a=i.clientHeight,r=t.clone().project(e);return r.x=(r.x+1)/2*s,r.y=-(r.y-1)/2*a,{x:r.x,y:r.y}}setupGUI(){let t;try{t=new(0,r.default)({autoPlace:!0,title:"Bubble Controls"})}catch(e){t={domElement:document.createElement("div"),add:()=>({step:()=>({onChange:()=>({name:()=>null})}),name:()=>null,onChange:()=>null})}}this.gui=t,this.container.appendChild(t.domElement),t.domElement.style.position="fixed",t.domElement.style.zIndex="19",t.domElement.style.top="10%",t.domElement.style.right="10%",this.guiControllers=[];let e=t.add(this.guiParams,"playPause").name("▶️ / ⏸️ Start/Pause");this.guiControllers.push(e);let i=t.add(this.guiParams,"viewMode",["2D","3D"]).name("View Mode").onChange(t=>{this.camera="2D"===t?this.camera2D:this.camera3D,this.controls.enabled="3D"===t,this.onWindowResize()});this.guiControllers.push(i);let s=t.add(this.guiParams,"showDashedLines").name("Show Initial Radius").onChange(t=>{this.staticCircles.forEach(e=>{e.visible=t})});this.guiControllers.push(s);let a=t.add(this.guiParams,"R_0",.001,.1);this.guiControllers.push(a),a.step(.001).name("R₀ (Initial Radius, m)").onChange(()=>{this.guiParams.isRunning=!1,this.setupPhysicsAndAnimation(),this.addTextLabels();for(let t=0;t<3;t++)this.resetAnimation(t)});let n=t=>{this.guiParams.isRunning=!1,this.resetAnimation(t),this.bubble_times=[0,0,0],this.bubble_active=[!0,!0,!0];for(let e=0;e<3;e++)e!==t&&(this.Ls[e]=this.guiParams[`L${e+1}`],this.resetAnimation(e));this.addTextLabels()},h=t.add(this.guiParams,"L1",.001,.2);this.guiControllers.push(h),h.step(.001).name("L₁ (Length 1, m)").onChange(()=>n(0));let o=t.add(this.guiParams,"L2",.001,.2);this.guiControllers.push(o),o.step(.001).name("L₂ (Length 2, m)").onChange(()=>n(1));let l=t.add(this.guiParams,"L3",.001,.2);this.guiControllers.push(l),l.step(.001).name("L₃ (Length 3, m)").onChange(()=>n(2));let c=t.add({reset:()=>this.resetAll()},"reset");this.guiControllers.push(c),c.name("\uD83D\uDD04 Reset All")}resetAll(){this.guiParams.R_0=.04,this.guiParams.L1=.01,this.guiParams.L2=.05,this.guiParams.L3=.1,this.guiParams.isRunning=!1,this.guiParams.showDashedLines=!0,this.setupPhysicsAndAnimation(),this.addTextLabels();for(let t=0;t<3;t++)this.resetAnimation(t);for(let t of this.guiControllers)try{t&&"function"==typeof t.updateDisplay&&t.updateDisplay()}catch(t){}this.renderer.render(this.scene,this.camera)}animate(){if(requestAnimationFrame(this.animate),"3D"===this.guiParams.viewMode&&this.controls.update(),this.textGroups&&this.circles.length>0){let t=this.guiParams.R_0*this.guiParams.scale_factor*2+.5,e=this.positions[0].y-t;this.Ls.forEach((t,i)=>{let s=this.positions[i],r=new a.Vector3(s.x,e,s.z),n=this.toScreenPosition(r,this.camera,this.renderer.domElement),h=this.textGroups[i].group;h.style.left=`${n.x}px`,h.style.top=`${n.y}px`})}if(this.renderer.render(this.scene,this.camera),!this.guiParams.isRunning)return;let t=this.clock.getDelta();for(let e=0;e<3;e++){if(!this.bubble_active[e])continue;let i=this.bubble_durations[e],s=this.bubble_times[e]+t;s>=i&&(s=i,this.bubble_active[e]=!1,this.textGroups[e].group.style.opacity=.5),this.bubble_times[e]=s;let a=function(t,e,i){return function(t,e,i,s=1e-6,a=100){let r=0,n=i,h=t(0),o=t(n);if(h*o>0)return 0;Math.abs(h)<Math.abs(o)&&([r,n]=[n,r],[h,o]=[o,h]);let l=r,c=h,u=0,m=0,d=!0;for(let e=0;e<a&&!(0===o||Math.abs(n-r)<=s);e++){((u=h!==c&&o!==c?r*o*c/((h-o)*(h-c))+n*h*c/((o-h)*(o-c))+l*h*o/((c-h)*(c-o)):n-(n-r)/(o-h)*o)-(3*r+n)/4)*(u-n)>=0||d&&Math.abs(u-n)>=Math.abs(n-l)/2||!d&&Math.abs(u-n)>=Math.abs(l-m)/2||d&&Math.abs(n-l)<Math.abs(s)||!d&&Math.abs(l-m)<Math.abs(s)?(u=(r+n)/2,d=!0):d=!1,m=l,l=n,c=o;let e=t(u);h*e<0?(n=u,o=e):(r=u,h=e),Math.abs(h)<Math.abs(o)&&([r,n]=[n,r],[h,o]=[o,h])}return n}(s=>(function(t,e,i){try{let s=c(e=>u(e,t),i,e),a=Math.pow(h,2)*o*t/63488e-16*(Math.pow(e,4)-Math.pow(i,4)),r=h/16e-6*Math.sqrt(98.38709677419355)*s;return a+r}catch(t){return console.error("Error in calc_t_gen:",t),0}})(t,e,s)-i,0,e,1e-6,100)}(this.guiParams[`L${e+1}`],this.guiParams.R_0,s),r=Math.max(0,a)*this.guiParams.scale_factor;this.circles[e]&&this.circles[e].scale.setScalar(r);let n=this.positions[e].y-r;this.circles[e]&&(this.circles[e].position.y=n),this.textGroups&&this.textGroups[e]&&(this.textGroups[e].time.textContent=`t: ${s.toFixed(3)} s`,this.textGroups[e].R.textContent=`R(t): ${(100*a).toFixed(2)} cm`)}this.bubble_active.every(t=>!t)&&(this.guiParams.isRunning=!1,this.clock.stop())}}document.addEventListener("DOMContentLoaded",()=>{try{new d("scene-container")}catch(t){console.error("Failed to initialize DeflatingBubbleScene:",t)}});
//# sourceMappingURL=bubble_simulation.12cbd1dd.js.map
